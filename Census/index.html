<!DOCTYPE html>
<html>
<head>
  <title>Census Data</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
  <link rel="stylesheet" href="http://js.arcgis.com/3.13/dijit/themes/claro/claro.css">
  <link rel="stylesheet" href="http://js.arcgis.com/3.13/esri/css/esri.css">
  <style>
    html, body, #mapDiv{
      padding: 0;
      margin: 0;
      height: 100%;
    }
	#HomeButton {
      position: absolute;
      top: 135px;
      left: 20px;
      z-index: 50;
    }
	#search {
        display: block;
        position: absolute;
        z-index: 1000;
        top: 20px;
        left: 74px;
    }
	#field1 { 
	    background: white;
        color: #3E3E35;
        margin: 0 auto;
		border: 1px solid #black; 
		border-radius: 5px; 
		box-shadow: 0 0 5px 3px gray; 
		outline: none; 
		padding: 5px;	
		margin: 5px;
    } 
	#basemapTitle { 
        background:rgba(56,56,56,.5);
        color: #fff;
        font-family: times;
        padding: 5px;
        text-align: center;
        z-index: 40;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid rgb(56,56,56);
    }
	#dashboard { 
        right: 30px;
        text-align: center;
        top: 30px;
        width: 300px;
    }
	#Splash{ 

        text-align: center;
		height: 60%;
        width: 60%;
		z-index: 9999;
		background-color: white;
		position: absolute;
		top: 200px;
		right: 400px;
		-webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid rgb(56,56,56);
    }
	#legendWrapper {
         background: #fff;
        color: #3E3E35;
        margin: 0 auto;
        text-align: left;
    }
	#slider { 
        right: 30px;
        text-align: center;
         bottom: 20px;
        width: 300px;
    }
	#LocateButton {
      position: absolute;
      top: 95px;
      left: 20px;
      z-index: 50;
    }
	#chart { 
        left: 30px;
        bottom: 20px;
        width: 410px;
		height: 400px;
    }
	#header {
		color: White;
		text-align: center;
		background:#3399ff;
		border: 1px solid rgb(56,56,56);
		font-family: times;
		font-weight: bold;
	}
	#mapDiv {
		border: 1px solid rgb(56,56,56);
	}
	#SliderText {
		color: black;
		font-size: 10px;
	}
	#chart, #slider, #dashboard {
		background:rgba(56,56,56,.5);
		color: white;
        font-family: times;
        height: auto;
        text-align: center;		
        overflow: hidden;
        padding: 5px;
        position: absolute;
		z-index: 40;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid rgb(56,56,56);
    }
	#demochart, #CensusSelect, #agechart, #statisticSelect,#genderchart {
        background: #fff;
        color: #3E3E35;
        text-align: left;
	}
	#seletctText, #ThemeSelect{
		color: #3E3E35;
		text-align: center;
	}		
  </style>
  
  <script src="http://js.arcgis.com/3.13/"></script>
  <script>
    var map, legend;
	var AGE_UNDER5, AGE_5_17, AGE_18_21, AGE_22_29, AGE_30_39, AGE_40_49, AGE_50_64, AGE_65_UP;
	var WHITE, BLACK, AMERI_ES, ASIAN, HAWN_PI, OTHER, MULT_RACE, HISPANIC, FEMALES, MALES, POP00_SQMI, MED_AGE_M, MED_AGE_F, AVE_HH_SZ,AVE_FAM_SZ;
	var gaugeValue, SQMI,POP2000,LegendTabTrue,CurrentAtt,currentRender;
    require(["esri/map", "esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","dijit/registry","dojo/number",
			"esri/plugins/FeatureLayerStatistics","dojo/aspect","esri/dijit/ColorInfoSlider","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol",
			"esri/renderers/SimpleRenderer","esri/graphic", "esri/Color","esri/dijit/LocateButton","dojox/charting/plot2d/Pie","dojox/charting/Chart",
			"dojox/charting/axis2d/Default","dojox/charting/action2d/Tooltip","dojox/charting/action2d/MoveSlice","dojox/charting/action2d/Highlight",
			"dijit/layout/TabContainer", "dijit/layout/ContentPane","dojo/parser","dojox/charting/widget/SelectableLegend","esri/renderers/smartMapping",
			"dojo/_base/array", "dojo/dom", "dojo/on","dojo/dom-construct","esri/dijit/Legend","dijit/form/Select", "esri/dijit/HomeButton",
			"dojo/store/Memory","dijit/TitlePane","esri/dijit/BasemapGallery","esri/arcgis/utils","esri/dijit/Geocoder","esri/dijit/Basemap","esri/basemaps",
			"esri/symbols/SimpleMarkerSymbol","dojox/charting/plot2d/Spider","dijit/layout/BorderContainer","dojox/charting/action2d/Magnify",
			"esri/dijit/util/busyIndicator","esri/dijit/util/busyIndicator","dojo/domReady!"], 
	function(Map,FeatureLayer,ArcGISTiledMapServiceLayer,registry,number,FeatureLayerStatistics,aspect,ColorInfoSlider,
				 SimpleFillSymbol, SimpleLineSymbol, SimpleRenderer, Graphic, Color, LocateButton,Pie,Chart,Default,
				Tooltip,MoveSlice,Highlight, TabContainer, ContentPane,parser,PieLegend,smartMapping,array,dom,on,
				domConstruct,Legend,Select, HomeButton, Memory,TitlePane,BasemapGallery, arcgisUtils ,Geocoder,Basemap,esriBasemaps,
				SimpleMarkerSymbol,Spider,BorderContainer,Magnify,busyIndicator,busyIndicator2) {
				 
    parser.parse();
	//////////////////////////////////////////// Create default values //////////////////////////////////////////////////////
	var currentStatistic = "natural-breaks";
	var currentField = "MED_AGE";
	var basemap = "streets";
	var med_test = "MED_AGE";
	var caption = "Stats";
	var value = 5;
	var isitLoaded = true;
	var title = "Click on map";
	var theme = "high-to-low";
	var currentAtt = "Median Age"
	var busyIndicator = busyIndicator.create({target: "SliderLegend", imageUrl: "http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/icons/images/loadingAnimation_rtl.gif", backgroundOpacity: 0});
	var busyIndicatorMap = busyIndicator2.create({target: "mapDiv", imageUrl: "http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/icons/images/loadingAnimation_rtl.gif", backgroundOpacity: 0});
	//////////////////////////////////////////// Create Map ///////////////////////////////////////////////
	map = new Map("mapDiv", {
		center: [-86.049, 38.485],
		zoom: 3,
		basemap: basemap
    });
	//////////////////////////////////////////// Create Basemap Gallery ///////////////////////////////////////////////
     var basemapGallery = new BasemapGallery({
        showArcGISBasemaps: false,
        map: map
      }, "basemapGallery");
      for (var basemap_key in esriBasemaps) {
      
        var esriBasemap = esriBasemaps[basemap_key];
        basemapGallery.add(
          new Basemap({
            id: basemap_key,
            layers: esriBasemap.baseMapLayers,
            thumbnailUrl: esriBasemap.thumbnailUrl,
            title: esriBasemap["title"]
          })
        );
        
        if (basemap_key == basemap) {
          basemapGallery.select(basemap_key);
        }
      }
    basemapGallery.startup();
	//////////////////////////////////////////// Create Geocoder ///////////////////////////////////////////////
	var geocoder = new Geocoder ({
		map:map,
		autoComplete: true,
		geocoderMenu: true,
		zoomScale: 100000
	}, "search");
	geocoder.startup();
	dom.byId("search_input").placeholder = "Search for address";
	var addressSymbol = new SimpleMarkerSymbol(
        SimpleMarkerSymbol.STYLE_CIRCLE, 15, 
          new SimpleLineSymbol(
            SimpleLineSymbol.STYLE_SOLID, 
            new Color([0, 0, 255, 0.5]), 8), 
          new Color([0, 0, 255])
    );
	geocoder.on("select", function (evt){
		map.graphics.clear();
		var point = evt.result.feature.geometry;
		var graphic = new Graphic(point, addressSymbol);
		map.graphics.add(graphic);
		map.infoWindow.setTitle("Adress");
        map.infoWindow.setContent(evt.result.name);
        map.infoWindow.show(evt.result.feature.geometry);
        map.infoWindow.resize(180, 100);
	});	
	geocoder.on("clear", function(){
		map.graphics.clear();
		map.infoWindow.hide();
	});
	//////////////////////////////////////////// Create Locate Button ///////////////////////////////////////////////
	var geoLocate = new LocateButton({
		map: map,
		highlightLocation: true,
		scale: 100000
		}, "LocateButton"
	);
	geoLocate.startup();
	geoLocate.on("locate", function(evt){
		map.graphics.clear();
		var point = evt.graphic.geometry;
		var graphic = new Graphic(point, addressSymbol);
		map.graphics.add(graphic);
		map.infoWindow.setTitle("Geo Locate");
        map.infoWindow.setContent("Found you!");
		map.infoWindow.show(point);
		map.infoWindow.resize(180, 100);
	});	
	map.infoWindow.on("hide", function(){
		map.graphics.clear();
	});
	//////////////////////////////////////////// Create Home Button ///////////////////////////////////////////////
	var home = new HomeButton({
        map: map
      }, "HomeButton");
      home.startup();
	//////////////////////////////////////////// Create highlight symbology ///////////////////////////////////////////////
	var highlightSymbol = new SimpleFillSymbol(
          SimpleFillSymbol.STYLE_NULL, 
          new SimpleLineSymbol(
            SimpleLineSymbol.STYLE_SOLID, 
            new Color([255,0,0]), 3
          ), 
          new Color([125,125,125,0.35])
        );
	//////////////////////////////////////////// Create Info Slider/ placeholder ///////////////////////////////////////////////	
	var colorInfoSlider = new ColorInfoSlider({
		colorInfo: {
			stops:[
				{color: new Color([92,92,92]), label: "50", value: 50}, 
				{color: new Color([92,92,92]), label: "51", value: 51}
			]
		},
		maxLabel: "$70000",
		minLabel: "$0",
		maxValue: 70000,
		minValue: 0,
		handles: [10000,30000,50000]
		}, "SliderLegend");
	colorInfoSlider.startup();
	//////////////////////////////////////////// Add layers ///////////////////////////////////////////////	
	var blockCensus = new FeatureLayer ("https://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/1", {
			"mode": FeatureLayer.MODE_ONDEMAND, 
			"outFields":["*"],
			"maxScale":0,
			"minScale":1000000,
			"opacity":0.8
		}); 
	var countyCensus = new FeatureLayer ("https://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/2", {
			"mode": FeatureLayer.MODE_ONDEMAND, 
			"outFields":["*"],
			"maxScale":1000001,
			"minScale":5000000,
			"opacity":0.8
		}); 
	var stateCensus = new FeatureLayer ("https://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/3", {
			"mode": FeatureLayer.MODE_ONDEMAND, 
			"outFields":["*"],
			"maxScale":5000001,
			"minScale":0,
			"opacity":0.8
		});

	var whichLayer = stateCensus;
	map.addLayers([ stateCensus,countyCensus,blockCensus]);
	////////////////////////////////////// Create the render for each layer /////////////////////////////////////////////
	function updateSmartMappingState(){
		smartMapping.createClassedColorRenderer({
			layer: stateCensus,
			field: currentField,
			basemap: basemap,
			classificationMethod: currentStatistic
		}).then(function (colorRenderer){
			stateCensus.setRenderer(colorRenderer.renderer);
			stateCensus.redraw();
			createLegend(map, whichLayer , currentField);
		})
	};
	
	function updateSmartMappingCounty(){
		smartMapping.createClassedColorRenderer({
			layer: countyCensus,
			field: currentField,
			basemap: basemap,
			classificationMethod: currentStatistic
		}).then(function (colorRenderer){
			countyCensus.setRenderer(colorRenderer.renderer);
			countyCensus.redraw();
			createLegend(map, whichLayer , currentField);
		})
	};
	
	function updateSmartMappingBlock(){
		smartMapping.createClassedColorRenderer({
			layer: blockCensus,
			field: currentField,
			basemap: basemap,
			classificationMethod: currentStatistic
		}).then(function (colorRenderer){
			blockCensus.setRenderer(colorRenderer.renderer);
			blockCensus.redraw();
			createLegend(map, whichLayer , currentField);
		})
	};
	///////////////////////// STATE CENSUS on click event  ///////////////////////////////////////////////////////////////////
	stateCensus.on("click", function(evt){
		map.graphics.clear();
		clickName = evt.graphic.attributes.STATE_NAME;
		document.getElementById('chartTitle').innerHTML = clickName;
		var highlightGraphic = new Graphic(evt.graphic.geometry,highlightSymbol);
        map.graphics.add(highlightGraphic);
		getAttributes(evt);
		gaugeVal(evt);
		document.getElementById('field1').innerHTML = clickName + "<hr>" + "Square Milage: " + number.format(SQMI) + "<hr>" + "Total Population: " + number.format(POP2000) + "<hr>" + CurrentAtt + 
		": " + number.format(Gaugevalue);
		Ages();
		Demographics ();
		Gender ();
		chart4name = "Selected";
		chart4.addSeries("USA", {data: {"Median Age Male": 34,"Pop per SqMi": 345,"Avg household size": 2.55,"Avg family size": 3.00,"Median Age Female": 37}}, { fill: "blue" });
		chart4.addSeries(chart4name, {data: {"Median Age Male": MED_AGE_M,"Pop per SqMi": POP00_SQMI,"Avg household size": AVE_HH_SZ,"Avg family size": AVE_FAM_SZ,"Median Age Female": MED_AGE_F}}, { fill: "red" });
		chart4.addSeries("Max", {data: {"Median Age Male": 35,"Pop per SqMi": 400,"Avg household size": 3.00,"Avg family size": 3.50,"Median Age Female": 38}}, { fill: "red" });
		chart4.addSeries("Min", {data: {"Median Age Male": 30,"Pop per SqMi": 1,"Avg household size": 2.00,"Avg family size": 2.00,"Median Age Female": 32}}, { fill: "yellow" });		
		chart4.render();
		chart4.removeSeries("Max");
		chart4.removeSeries("Min");		
	});
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	///////////////////////// COUNTY CENSUS on click event ///////////////////////////////////////////////////////////////////
	countyCensus.on("click", function(evt){
		map.graphics.clear();
		clickName = evt.graphic.attributes.NAME;
		document.getElementById('chartTitle').innerHTML = clickName + " County";
		var highlightGraphic = new Graphic(evt.graphic.geometry,highlightSymbol);
        map.graphics.add(highlightGraphic);
		getAttributes(evt);
		gaugeVal(evt);
		document.getElementById('field1').innerHTML = clickName + " County" + "<hr>" + "Square Milage: " + number.format(SQMI) + "<hr>" + "Total Population: " + number.format(POP2000) + "<hr>" + CurrentAtt + 
		": " + number.format(Gaugevalue);
		Ages();
		Demographics ();
		Gender ();
		chart4name = "Selected";
		chart4.addSeries(chart4name, {data: {"Median Age Male": MED_AGE_M,"Pop per SqMi": POP00_SQMI,"Avg household size": AVE_HH_SZ,"Avg family size": AVE_FAM_SZ,"Median Age Female": MED_AGE_F}}, { fill: "red" });
		chart4.addSeries("Max", {data: {"Median Age Male": 38,"Pop per SqMi": 8700,"Avg household size": 4.00,"Avg family size": 4.00,"Median Age Female": 41}}, { fill: "red" });
		chart4.addSeries("Min", {data: {"Median Age Male": 30,"Pop per SqMi": 1,"Avg household size": 2.00,"Avg family size": 2.00,"Median Age Female": 30}}, { fill: "yellow" });
		chart4.render();
		chart4.removeSeries("Max");
		chart4.removeSeries("Min");
	});
	///////////////////////// BLOCK CENSUS on click event  ///////////////////////////////////////////////////////////////////////
	blockCensus.on("click", function(evt){
		map.graphics.clear();
		clickName = evt.graphic.attributes.TRACT;
		document.getElementById('chartTitle').innerHTML = "Tract: " + clickName;
		var highlightGraphic = new Graphic(evt.graphic.geometry,highlightSymbol);
        map.graphics.add(highlightGraphic);
		getAttributes(evt);
		gaugeVal(evt);
		document.getElementById('field1').innerHTML = "Tract: " + clickName +  "<hr>" + "Square Milage: " + number.format(SQMI) + "<hr>" + "Total Population: " + number.format(POP2000) + "<hr>" + CurrentAtt + 
		": " + number.format(Gaugevalue);
		Ages();
		Demographics ();
		Gender ();	
		chart4name = "Selected";	
		chart4.addSeries(chart4name, {data: {"Median Age Male": MED_AGE_M,"Pop per SqMi": POP00_SQMI,"Avg household size": AVE_HH_SZ,"Avg family size": AVE_FAM_SZ,"Median Age Female": MED_AGE_F}}, { fill: "red" });
		chart4.addSeries("Max", {data: {"Median Age Male": 38,"Pop per SqMi": 8700,"Avg household size": 4.00,"Avg family size": 4.00,"Median Age Female": 41}}, { fill: "red" });
		chart4.addSeries("Min", {data: {"Median Age Male": 30,"Pop per SqMi": 1,"Avg household size": 2.00,"Avg family size": 2.00,"Median Age Female": 30}}, { fill: "yellow" });
		chart4.render();
		chart4.removeSeries("Max");
		chart4.removeSeries("Min");
	});
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////
	var chart3 = new Chart("genderchart",{
	  title: "Gender",
      titlePos: "bottom",
      titleGap: 8,
      titleFont: "bold normal normal 10pt Arial",
      titleFontColor: "blue"
	});
	chart3.addPlot("default", {type: Pie, font: "normal normal 11pt Tahoma",fontColor: "black",labelOffset: -30,radius: 70,startAngle: 45,labelStyle: "columns",labelWiring: "black"});
	chart3.addAxis("x");
	chart3.addAxis("y", {vertical: true});
	chart3.addSeries("Series A", [
		{y:  138053563, text: "Male",  color: "blue",  stroke: "black", tooltip: "138,053,563"},
		{y:  143368343, text: "Female",  color: "red",  stroke: "black", tooltip: "143,368,343"}
		]);
	var anim10c = new Tooltip(chart3, "default");
	var anim10a = new MoveSlice(chart3, "default");
	var anim10b = new Highlight(chart3, "default");
	chart3.render();	
	//////////////////////////// CREATE AGE CHART /////////////////////////////////////////////////////////////////////
	var chart1 = new Chart("agechart",{
	  title: "Age Distribution",
      titlePos: "bottom",
      titleGap: 8,
      titleFont: "bold normal normal 10pt Arial",
      titleFontColor: "blue"
	});
	chart1.addPlot("default", {type: Pie, font: "normal normal 11pt Tahoma",fontColor: "black",labelOffset: -30,radius: 70,startAngle: 45,labelStyle: "columns",labelWiring: "black"});
	chart1.addAxis("x");
	chart1.addAxis("y", {vertical: true});
	chart1.addSeries("Series A", [
		{y: 3, text: "5 & Under",  color: "pink",  stroke: "black", tooltip: "18,354,443"},
		{y: 3, text: "5 - 17",   color: "red",   stroke: "black", tooltip: "35,213,428"},
		{y: 4, text: "18 - 21", color: "green", stroke: "black", tooltip: " 17,754,015"},
		{y: 5, text: "22 - 29",  color: "blue",  stroke: "black", tooltip: "40,333,356"},
		{y: 6, text: "30 - 39", color: "white", stroke: "black", tooltip: "41,826,004"},
		{y: 5, text: "40 - 49",  color: "yellow",  stroke: "black", tooltip: "31,488,359"},
		{y: 4, text: "50 - 64",  color: "purple",  stroke: "black", tooltip: "32,498,436"},
		{y: 3, text: "65 & Up",  color: "orange",  stroke: "black", tooltip: "31,241,831"}
		]);
	var anim10c = new Tooltip(chart1, "default");
	var anim10a = new MoveSlice(chart1, "default");
	var anim10b = new Highlight(chart1, "default");
	chart1.render();
	//////////////////////////// CREATE DEMOGRAPHIC CHART /////////////////////////////////////////////////////////////////////
	var chart2 = new Chart("demochart",{
	  title: "Demographic",
      titlePos: "bottom",
      titleGap: 8,
      titleFont: "bold normal normal 10pt Arial",
      titleFontColor: "blue"
	});
	chart2.addPlot("default", {type: Pie, font: "normal normal 11pt Tahoma",fontColor: "black",labelOffset: -30,radius: 80,startAngle: 45,labelStyle: "columns",labelWiring: "black"});
	chart2.addAxis("x");
	chart2.addAxis("y", {vertical: true});
	chart2.addSeries("Series A", [
		{y: 211460626,  text: "White",   color: "pink",  stroke: "black", tooltip: "211,460,626"},
		{y: 34658190, text: "Black",   color: "red",   stroke: "black", tooltip: "34,658,190"},
		{y: 2475956 , text: "AI/AN", color: "green", stroke: "black", tooltip: "24,75,956"},
		{y: 10242998,  text: "Asian", color: "blue",  stroke: "black", tooltip: "10,242,998"},
		{y: 87441, text: "NH/PI", color: "white", stroke: "black", tooltip: "87,441"},
		{y: 9804847, text: "Other",   color: "yellow",  stroke: "black", tooltip: "9,804,847"},
		{y: 6826228,  text: "Multi Race",   color: "purple",  stroke: "black", tooltip: "6,826,228"},
		{y: 22354059,  text: "Hispanic",  color: "orange",  stroke: "black", tooltip: "22,354,059"}
		]);
	var anim10c = new Tooltip(chart2, "default");
	var anim10a = new MoveSlice(chart2, "default");
	var anim10b = new Highlight(chart2, "default");
	chart2.render();
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	var chart4 = new Chart("statChart");
	chart4.addPlot("default", {type: Spider,labelOffset:-10,seriesFillAlpha:0.2,markerSize:4,precision:0,spiderType:"polygon"});
	//chart2.setTheme(Tom);
	chart4.addSeries("USA", {data: {"Median Age Male": 34,"Pop per SqMi": 345,"Avg household size": 2.55,"Avg family size": 3.00,"Median Age Female": 37}}, { fill: "blue" });
	chart4.addSeries("Max", {data: {"Median Age Male": 35,"Pop per SqMi": 350,"Avg household size": 3.00,"Avg family size": 3.50,"Median Age Female": 41}}, { fill: "red" });
	chart4.addSeries("Min", {data: {"Median Age Male": 30,"Pop per SqMi": 1,"Avg household size": 2.00,"Avg family size": 2.00,"Median Age Female": 30}}, { fill: "yellow" });
	var anim11c = new Tooltip(chart4);
	var anim11b = new Highlight(chart4);
	var anim11b = new Magnify(chart4);
	chart4.render();
	chart4.removeSeries("Max");
	chart4.removeSeries("Min");
	/////////////////////////////////////////////////// Update the pie charts //////////////////////////////////////////////////////////////////
	function Demographics () {
		chart2.updateSeries("Series A", [
		{y: WHITE, text: "White",  color: "pink",  stroke: "black", tooltip: number.format(WHITE)},
		{y: BLACK, text: "Black",   color: "red",   stroke: "black", tooltip: number.format(BLACK)},
		{y: AMERI_ES, text: "AI/AN", color: "green", stroke: "black", tooltip: number.format(AMERI_ES)},
		{y: ASIAN, text: "Asian",  color: "blue",  stroke: "black", tooltip: number.format(ASIAN)},
		{y: HAWN_PI, text: "NH/PI", color: "white", stroke: "black", tooltip: number.format(HAWN_PI)},
		{y: OTHER, text: "Other",  color: "yellow",  stroke: "black", tooltip: number.format(OTHER)},
		{y: MULT_RACE, text: "Multi Race",  color: "purple",  stroke: "black", tooltip: number.format(MULT_RACE)},
		{y: HISPANIC, text: "Hispanic",  color: "orange",  stroke: "black", tooltip: number.format(HISPANIC)}
		]);
		chart2.render();
	};
	
	function Ages () {
		chart1.updateSeries("Series A", [
		{y: AGE_UNDER5, text: "5 & Under",  color: "pink",  stroke: "black", tooltip: number.format(AGE_UNDER5)},
		{y: AGE_5_17, text: "5 - 17",   color: "red",   stroke: "black", tooltip: number.format(AGE_5_17)},
		{y: AGE_18_21, text: "18 - 21", color: "green", stroke: "black", tooltip: number.format(AGE_18_21)},
		{y: AGE_22_29, text: "22 - 29",  color: "blue",  stroke: "black", tooltip: number.format(AGE_22_29)},
		{y: AGE_30_39, text: "30 - 39", color: "white", stroke: "black", tooltip: number.format(AGE_30_39)},
		{y: AGE_40_49, text: "40 - 49",  color: "yellow",  stroke: "black", tooltip: number.format(AGE_40_49)},
		{y: AGE_50_64, text: "50 - 64",  color: "purple",  stroke: "black", tooltip: number.format(AGE_50_64)},
		{y: AGE_65_UP, text: "65 & Up",  color: "orange",  stroke: "black", tooltip: number.format(AGE_65_UP)}
		]);
		chart1.render();
	};
	
	function Gender () {
		chart3.updateSeries("Series A", [
		{y: MALES, text: "Male",  color: "blue",  stroke: "black", tooltip: number.format(MALES)},
		{y: FEMALES, text: "Female",  color: "red",  stroke: "black", tooltip: number.format(FEMALES)}
		]);
		chart3.render();
	};
	///////////////////////////////////// Create the Legend ///////////////////////////////////////////////////////////////////////////////
	 function createLegend(map, whichLayer, currentField ) {
            if (legend) {
               legend.destroy();
               domConstruct.destroy(dom.byId("legendDiv"));
            }
            var legendDiv = domConstruct.create("div", {
               id: "legendDiv"
            }, dom.byId("legendWrapper"));
            legend = new Legend({
               map: map,
               layerInfos: [{
                  layer: whichLayer,
                  title: "Census Attribute: " + currentField
            }]
            }, legendDiv);
            legend.startup();
         }
	///////////////////////////////////// Sniff the visible Layer ///////////////////////////////////////////////////////////////////////////////
	map.on("zoom-end", function(evt){
		if (dijit.byId("LegendTab").selected){
			if (evt.target.__LOD.scale > 4622325){
				whichLayer = stateCensus;
				updateSmartMappingState();
			} else if (evt.target.__LOD.scale > 577791){
				whichLayer = countyCensus;
				updateSmartMappingCounty();
			} else {
				whichLayer = blockCensus;
				updateSmartMappingBlock();
			}
		} else {		
			if (evt.target.__LOD.scale > 4622325){
				whichLayer = stateCensus;
			} else if (evt.target.__LOD.scale> 577791){
				whichLayer = countyCensus;
			} else {
				whichLayer = blockCensus;

			}
			sliderSmart();

		}
	});
	////////////////////////////////// Create Attribute Select ///////////////////////////////////////////////////////////////////////////////////////////////	
	var fieldSelect = new Select({
		name: "select",
		options: [
			{ label: "Median Age", value: "MED_AGE", selected: true  },
			{ label: "Population per SqMile", value: "POP00_SQMI"},
			{ label: "White", value: "WHITE"},
			{ label: "Black", value: "BLACK"},
			{ label: "Native American", value: "AMERI_ES" },
			{ label: "Asian", value: "ASIAN" },
			{ label: "Native Hawaiian/Pacific Islander", value: "HAWN_PI" },
			{ label: "Hispanic", value: "HISPANIC" },
			{ label: "Multiple Races", value: "MULT_RACE" },
			{ label: "Other", value: "OTHER" }
		]
	    },"CensusSelect");
	fieldSelect.startup();
	
	////////////////////////////////// Create Statistic Select ///////////////////////////////////////////////////////////////////////////////////////////////	
	var statisticSelect = new Select({
		name: "select",
		options: [
			{ label: "Natural Breaks", value: "natural-breaks", selected: true  },
			{ label: "Equal Interval", value: "equal-interval"},
			{ label: "Quantile", value: "quantile"}
		]
	    },"statisticSelect");
	statisticSelect.startup();
	////////////////////////////////// Create Statistic change event ///////////////////////////////////////////////////////////////////////////////////////////////
	statisticSelect.on("change", function (evt){
		currentStatistic = evt;
		if (dijit.byId("LegendTab").selected){
			if (whichLayer == stateCensus) {
				updateSmartMappingState();
			} else if (whichLayer == countyCensus){
				updateSmartMappingCounty();
			} else if (whichLayer == blockCensus){
				updateSmartMappingBlock();
			}
		} else {
			sliderSmart();
		}
	});
	////////////////////////////////// Create Attribute change event ///////////////////////////////////////////////////////////////////////////////////////////////
	fieldSelect.on("change", function (evt){
		currentField = evt;
		if (dijit.byId("LegendTab").selected){
			if (whichLayer == stateCensus) {
				updateSmartMappingState();
			} else if (whichLayer == countyCensus){
				updateSmartMappingCounty();
			} else if (whichLayer == blockCensus){
				updateSmartMappingBlock();
			}
		} else {
			sliderSmart();
		}
	});
	////////////////////////////////// Create Basemap change event ///////////////////////////////////////////////////////////////////////////////////////////////
	basemapGallery.on("selection-change", function(evt){
		basemap = evt.target.getSelected().id;
		if (dijit.byId("LegendTab").selected){
			if (whichLayer == stateCensus) {
				updateSmartMappingState();
			} else if (whichLayer == countyCensus){
				updateSmartMappingCounty();
			} else if (whichLayer == blockCensus){
				updateSmartMappingBlock();
			}
		} else {
			sliderSmart();
		}
	});
	////////////////////////////////// Get field values depending on select///////////////////////////////////////////////////////////////////////////////////////////////
	function gaugeVal(evt){
		if (fieldSelect.value == "MED_AGE"){
			Gaugevalue = evt.graphic.attributes.MED_AGE;
			CurrentAtt = "Median Age";
		} else if (fieldSelect.value == "POP00_SQMI") {
			Gaugevalue = evt.graphic.attributes.POP00_SQMI;
			CurrentAtt = "Pupulation per Square Mile";
		} else if (fieldSelect.value =="WHITE"){
			Gaugevalue = evt.graphic.attributes.WHITE;
			CurrentAtt = "White";
		} else if (fieldSelect.value == "BLACK") {
			Gaugevalue = evt.graphic.attributes.BLACK;
			CurrentAtt = "Black";
		} else if (fieldSelect.value == "AMERI_ES") {
			Gaugevalue = evt.graphic.attributes.AMERI_ES;
			CurrentAtt = "Native American";
		} else if (fieldSelect.value == "ASIAN") {
			Gaugevalue = evt.graphic.attributes.ASIAN;
			CurrentAtt = "Asian";
		} else if (fieldSelect.value == "HAWN_PI") {
			Gaugevalue = evt.graphic.attributes.HAWN_PI;
			CurrentAtt = "Hawaiian/Pacific";
		} else if (fieldSelect.value == "HISPANIC") {
			Gaugevalue = evt.graphic.attributes.HISPANIC;
			CurrentAtt = "Hispanic";
		} else if (fieldSelect.value == "MULT_RACE") {
			Gaugevalue = evt.graphic.attributes.MULT_RACE;
			CurrentAtt = "Multiple Race";
		} else if (fieldSelect.value == "OTHER") {
			Gaugevalue = evt.graphic.attributes.OTHER;
			CurrentAtt = "Other";
		}	
	};
	////////////////////////////////// Get Values from current layer ///////////////////////////////////////////////////////////////////////////////////////////////
	function getAttributes(evt){
		AGE_UNDER5 = evt.graphic.attributes.AGE_UNDER5;
		AGE_5_17 = evt.graphic.attributes.AGE_5_17;
		AGE_18_21 = evt.graphic.attributes.AGE_18_21;
		AGE_22_29 = evt.graphic.attributes.AGE_22_29;
		AGE_30_39 = evt.graphic.attributes.AGE_30_39;
		AGE_40_49 = evt.graphic.attributes.AGE_40_49;
		AGE_50_64 = evt.graphic.attributes.AGE_50_64;
		AGE_65_UP = evt.graphic.attributes.AGE_65_UP;		
		WHITE = evt.graphic.attributes.WHITE;
		BLACK = evt.graphic.attributes.BLACK;
		AMERI_ES = evt.graphic.attributes.AMERI_ES;
		ASIAN = evt.graphic.attributes.ASIAN;
		HAWN_PI= evt.graphic.attributes.HAWN_PI;
		OTHER = evt.graphic.attributes.OTHER;
		MULT_RACE = evt.graphic.attributes.MULT_RACE;
		HISPANIC= evt.graphic.attributes.HISPANIC;
		POP00_SQMI = evt.graphic.attributes.POP00_SQMI;
		MED_AGE_M = evt.graphic.attributes.MED_AGE_M;
		MED_AGE_F = evt.graphic.attributes.MED_AGE_F;
		AVE_HH_SZ = evt.graphic.attributes.AVE_HH_SZ;
		AVE_FAM_SZ = evt.graphic.attributes.AVE_FAM_SZ;	
		FEMALES = evt.graphic.attributes.FEMALES;
		MALES = evt.graphic.attributes.MALES;
		SQMI = evt.graphic.attributes.SQMI;
		POP2000 = evt.graphic.attributes.POP2000;
	};
	////////////////////////////////// Create interactive Legend ///////////////////////////////////////////////////////////////////////////////////////////////
	function sliderSmart(){
		busyIndicator.show();
		smartMapping.createColorRenderer({
          layer: whichLayer,
          field: currentField,
          basemap: basemap,
          theme: theme
        }).then(function (colorRenderer){
			whichLayer.setRenderer(colorRenderer.renderer);
			whichLayer.redraw();
			var sliderHandleInfo = getSliderHandlePositions(theme);
			colorInfoSlider.set("colorInfo", colorRenderer.renderer.visualVariables[0]);
			colorInfoSlider.set("minValue", 0);
			colorInfoSlider.set("maxValue", colorRenderer.statistics.max);
			colorInfoSlider.set("statistics", colorRenderer.statistics);
			colorInfoSlider.set("handles",sliderHandleInfo["handles"]);
			colorInfoSlider.set("primaryHandle", sliderHandleInfo["primaryHandle"]);
			busyIndicator.hide();
		    colorInfoSlider.on("handle-value-change", function (sliderValueChange){
				whichLayer.renderer.setVisualVariables([sliderValueChange]);
				whichLayer.redraw();
            });
		});
		};
	
	
	////////////////////////////////// Legend Tab change event ///////////////////////////////////////////////////////////////////////////////////////////////
	var InteractiveTab1 = registry.byId("InteractiveTab");
		aspect.after(InteractiveTab1 ,"_onShow", function() {
		sliderSmart();       
		});
		
	var LegendTab1 = registry.byId("LegendTab");
		aspect.after(LegendTab1 ,"_onShow", function() {
			if (whichLayer == stateCensus) {
				updateSmartMappingState();
			} else if (whichLayer == countyCensus){
				updateSmartMappingCounty();
			} else if (whichLayer == blockCensus){
				updateSmartMappingBlock();
			}
		   
		});
////////////////////////////////// Get theme for Interactive Legend ///////////////////////////////////////////////////////////////////////////////////////////////	
     function getSliderHandlePositions(theme){
        switch (theme) {
          case "high-to-low":
            return {
              handles: [0, 4],
              primaryHandle: null
            };
          case "above-and-below":
            return {
              handles: [0, 2, 4],
              primaryHandle: 2
            };
          case "centered-on":
            return {
              handles: [0, 2, 4],
              primaryHandle: 2
            };
          case "extremes":
            return {
              handles: [0, 2, 4],
              primaryHandle: null
            };
          case "group-similar":
            return {
              handles: [0, 1, 2, 3, 4],
              primaryHandle: null
            };
        }
      }
////////////////////////////////// Change interactive Legend depending on theme////////////////////////////////////////////////////////////////////////////////////		  
	        dom.byId("color-renderer-theme").onchange = function (){
              theme = this.value;
              //busyIndicator.show();
			  busyIndicator.show();
              smartMapping.createColorRenderer({
                layer: whichLayer,
                field: currentField,
                basemap: basemap,
                theme: theme
              }).then(function (colorRenderer){
                whichLayer.setRenderer(colorRenderer.renderer);
                whichLayer.redraw();
                var sliderHandleInfo = getSliderHandlePositions(theme);
                colorInfoSlider.set("minValue", 0);
                colorInfoSlider.set("maxValue", colorRenderer.statistics.max);
                colorInfoSlider.set("colorInfo", colorRenderer.renderer.visualVariables[0]);
                colorInfoSlider.set("handles", sliderHandleInfo["handles"]);
                colorInfoSlider.set("primaryHandle", sliderHandleInfo["primaryHandle"]);
				busyIndicator.hide();
              })
			};
////////////////////////////////// Show busy Indicator if layers load slow////////////////////////////////////////////////////////////////////////////////////	
			stateCensus.on("update-start", function(){
				isitLoaded = false;
				setTimeout(function () {
					if (isitLoaded == false) {
						busyIndicatorMap.show();
						isitLoaded = true;
					}
				}, 500);
			});
			stateCensus.on("update-end", function(){
				isitLoaded = true;
				busyIndicatorMap.hide();
			});
			countyCensus.on("update-start", function(){
				isitLoaded = false;
				setTimeout(function () {
					if (isitLoaded == false) {
						busyIndicatorMap.show();
						isitLoaded = true;
					}
				}, 500);
			});
			countyCensus.on("update-end", function(){
				isitLoaded = true;
				busyIndicatorMap.hide();
			});
			blockCensus.on("update-start", function(){
				isitLoaded = false;
				setTimeout(function () {
					if (isitLoaded == false) {
						busyIndicatorMap.show();
						isitLoaded = true;
					}
				}, 500);
			});
			blockCensus.on("update-end", function(){
				isitLoaded = true;
				busyIndicatorMap.hide();
			});
//////////////////////////////////Add the startup splash screen ////////////////////////////////////////////////////////////////////////////////////			
			function init() {
				dialogWelcome.show();
			}
			dojo.addOnLoad(init); 
});
  </script>
</head>
<body class="claro">

<div id="content"
     data-dojo-type="dijit/layout/BorderContainer"
     data-dojo-props="design:'headline', gutters:true"
     style="width: 100%; height: 100%; margin: 0; color: #1F5C99;">
	 
		<div data-dojo-type="dijit/Dialog" data-dojo-id="dialogWelcome" title="Explore your neighborhood through the US Census" style="width: 900px ">
        <table class="dijitDialogPaneContentArea">
            <tr>
                <td>
                    <div id="divDialogMessage"><div><img src="http://i.imgur.com/WfmvFfU.png" alt="Census" style="align: center" ></div>
					<br>
					I created this application to explore the US Census beyond just looking at the attribute table, but making it as interactive for the user as possible. 
					This is especially an interesting subject in the US, which was built by so many different ethnicities. 
					<p>
					Using 
					<a class="one" href="http://www.esri.com/landing-pages/arcgis-online/smart-mapping" target="_blank">ESRI Smart Mapping</a> 
					you are able to better visualize the data you are interested in. You can use the interactive legend to adjust the Layer render to 
					better explore the data that interests you. You will be able to use an address locator or location button to find the area you are interested in
					</div>
					<br>
					<div><img src="http://i.imgur.com/3sKsT57.gif" alt="Census" style="align: center" ></div>
                </td>
            </tr>
        </table>
        <div class="dijitDialogPaneActionBar">
            <button id="buttonClose" data-dojo-type="dijit/form/Button" type="button" style="align-content: center" onclick="dialogWelcome.onCancel();">Close</button>
        </div>
    </div>
	<div id="mapDiv"
		data-dojo-type="dijit/layout/ContentPane"
		data-dojo-props="region:'center'">
		<div id="LocateButton"></div>
		<div id="HomeButton"></div>
		<div id="search"></div>
		<div id="dashboard">
			<span style='text-align:center;'>Information</span>
			<div id="field1">Click anywhere within the United States to get census information</div>  
		</div>
		<div id="slider">
			<div id="TabContainer" data-dojo-type="dijit/layout/TabContainer"style="width: 300px; height: 370px">
				<div id="LegendTab" data-dojo-type="dijit/layout/ContentPane" title="Legend" data-dojo-props="selected:true"style="width: 200px; height: 200px">
					<div id="legendWrapper"></div>
					<div id="seletctText">Select Statistics:</div>
					<div id="statisticSelect"></div>
				</div>
				<div id="InteractiveTab"  data-dojo-type="dijit/layout/ContentPane" title="Interactive Legend" data-dojo-props="selected:true"style="width: 200px; height: 210px">
					<div id="SliderText"> Use the handles or click on the numbers to change them. </div>
					<div id="SliderLegend"></div>
					<div id="ThemeSelect">
						Theme:
						<select id="color-renderer-theme">
						<option value="high-to-low" selected>High to low</option>
						<option value="above-and-below">Above and below</option>
						<option value="centered-on">Centered on</option>
						<option value="extremes">Extremes</option>
						</select>
					</div>
				</div>
			</div>
			<div>Select which data you want to show:</div>
			<div id="CensusSelect"></div>
		</div>
		<div id="chart">
			<span id="chartTitle" style='text-align:center;'>USA</span>
			<div data-dojo-type="dijit/layout/TabContainer"style="width: 410px; height: 380px">
				<div data-dojo-type="dijit/layout/ContentPane" title="Age" data-dojo-props="selected:true"style="width: 400px; height: 300px">
					<div id="agechart"></div>
				</div>
				<div id="piecharts"data-dojo-type="dijit/layout/ContentPane" title="Demographic" data-dojo-props="selected:false"style="width: 400px; height: 300px">
					<div id="demochart"></div>
				</div>
				<div data-dojo-type="dijit/layout/ContentPane" title="Gender" data-dojo-props="selected:false"style="width: 400px; height: 300px">
					<div id="genderchart"></div>
				</div>
				<div data-dojo-type="dijit/layout/ContentPane" title="Statistics" data-dojo-props="selected:false"style="width: 400px; height: 300px">
					<div id="statChart"><div id="legend1"></div></div>
				</div>
			</div>		
		</div>
		<div style="position:absolute; left:74px; top:60px; z-Index:999;">
			<div data-dojo-type="dijit/TitlePane" id="basemapTitle"
				data-dojo-props="title:'Switch Basemap', closable:false, open:false" >
				<div data-dojo-type="dijit/layout/ContentPane" style="width:380px;  height:280px; overflow:auto;">
					<div id="basemapGallery"></div>
				</div>
			</div>
		</div>
	</div>
	<div id="header"
       data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'top'">
	  <span id="mapTitle">Explore your neighborhood through the Census</span>
	</div>
</div>
</body>
</html>